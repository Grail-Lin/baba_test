<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>Facebook 分享</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script async defer crossorigin="anonymous"
      src="https://connect.facebook.net/en_US/sdk.js"></script>
    <style>
      body {
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #fff;
        color: #333;
      }
      #manual-close {
        display: none;
        margin-top: 20px;
        text-align: center;
      }
      #manual-close button {
        padding: 10px 16px;
        font-size: 16px;
        border: none;
        border-radius: 6px;
        background-color: #4267B2;
        color: white;
        cursor: pointer;
      }
    </style>
    <script>
      function getParam(name) {
        return new URLSearchParams(window.location.search).get(name);
      }

      function closeWindowFallback() {
        document.getElementById("manual-close").style.display = "block";
      }

      window.fbAsyncInit = function () {
        FB.init({
          appId: "656281544074641", // App ID
          version: "v19.0",
        });

        const url = getParam("url");
        const quote = getParam("quote");
        const hashtag = getParam("hashtag");

        if (!url) {
          document.body.innerHTML =
            "<p style='color:red;'>無效的分享網址</p>";
          return;
        }

        const shareOptions = {
          method: "share",
          href: url,
        };
        if (quote) shareOptions.quote = quote;
        if (hashtag) shareOptions.hashtag = hashtag;

        FB.ui(shareOptions, function (response) {
          try {
            window.close();
            setTimeout(() => {
              if (!window.closed) {
                closeWindowFallback();
              }
            }, 500);
          } catch (e) {
            closeWindowFallback();
          }
        });
      };
    </script>
  </head>
  <body>
    <p>正在載入 Facebook 分享視窗...</p>
    <div id="manual-close">
      <p>分享完成，若視窗未自動關閉，請手動點選：</p>
      <button onclick="window.close()">關閉視窗</button>
    </div>
  </body>
</html>
